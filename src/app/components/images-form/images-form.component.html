<form
  class="lcc-form"
  [formGroup]="form"
  (ngSubmit)="onSubmit(album)">
  <div class="lcc-form-fields">
    <label class="lcc-required-field">Albums:</label>
    <div
      class="albums-container"
      (click)="this.form.controls.albums.markAsTouched()">
      <input
        id="album-input"
        class="album-input"
        [class.invalid]="form.controls.albums.errors && form.controls.albums.touched"
        type="text"
        name="album"
        formControlName="album"
        maxlength="120"
        [placeholder]="album ? 'Album name' : 'New album'"
        (click)="this.form.controls.albums.markAsTouched()" />
      <fieldset
        class="existing-album-fieldset"
        [class.invalid]="form.controls.albums.errors && form.controls.albums.touched"
        (click)="this.form.controls.albums.markAsTouched()">
        @for (album of existingAlbums; track album) {
          <div class="existing-album">
            <input
              [id]="'album-' + album"
              type="checkbox"
              name="albums"
              [checked]="form.controls.albums.value.includes(album)"
              (change)="onToggleAlbum(album)" />
            <label
              class="lcc-truncate"
              [for]="'album-' + album">
              {{ album }}
            </label>
          </div>
        }
      </fieldset>
    </div>
    <lcc-form-error-icon
      [control]="
        form.controls.albums.errors ? form.controls.albums : form.controls.album
      ">
    </lcc-form-error-icon>
  </div>

  <label
    class="choose-files-button lcc-secondary-button"
    type="button"
    [tooltip]="imageEntities.length ? 'Add more files' : 'Choose files'">
    <mat-icon>add_photo_alternate</mat-icon>
    <input
      type="file"
      accept="image/*"
      multiple
      (change)="onChooseFiles($event)" />
  </label>

  <div
    formArrayName="images"
    class="images-grid">
    @for (
      imageControl of form.controls.images.controls;
      track imageControl;
      let i = $index
    ) {
      <div
        class="lcc-form-fields"
        [formGroupName]="i">
        <div class="image-container full-span">
          <img
            [image]="{
              caption: 'Image preview',
              thumbnailUrl: imageEntities[i].image.thumbnailUrl,
              originalUrl:
                imageEntities[i].image.originalUrl || 'assets/fallback-image.png',
            }" />
        </div>

        <label
          [for]="'caption-input-' + i"
          class="lcc-required-field">
          Caption:
        </label>
        <input
          [id]="'caption-input-' + i"
          type="text"
          formControlName="caption"
          maxlength="120" />
        <lcc-form-error-icon [control]="imageControl.controls.caption">
        </lcc-form-error-icon>

        <div class="cover-image-input-container">
          <input
            [id]="'cover-image-radio-' + i"
            class="cover-image-input"
            type="radio"
            name="coverImage"
            [checked]="imageControl.controls.coverForAlbum.value === album"
            (change)="onSetCoverImage(i)" />
          <label
            class="cover-image-label"
            [for]="'cover-radio-' + i">
            Use as album cover
          </label>
        </div>
      </div>
    }
  </div>

  <aside class="lcc-required-fields-legend">Required fields</aside>

  <hr />

  <div class="lcc-form-buttons-container">
    <button
      class="cancel-button lcc-secondary-button"
      type="button"
      (click)="onCancel()">
      Cancel
    </button>
    <button
      class="submit-button lcc-primary-button"
      type="submit"
      [disabled]="form.invalid || !hasUnsavedChanges">
      {{ album ? 'Update' : 'Add' }}
    </button>
  </div>
</form>
